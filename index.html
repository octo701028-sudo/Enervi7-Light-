
<!DOCTYPE html><html lang="zh-Hant"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Enervi7 v7.2</title><link rel="manifest" href="manifest.json"><meta name="theme-color" content="#6a00ff">
<style>
:root{--bg:#0f0b1e;--panel:#141126;--accent:#6a00ff;--text:#ece8ff;--muted:#bdb6df}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
header{padding:16px;background:linear-gradient(90deg,#6a00ff,#8b5cf6)}
h1{margin:0;font-size:22px}.sub{color:#d6ccff;font-size:13px}
.wrap{max-width:980px;margin:16px auto;padding:0 14px}
.card{background:var(--panel);border:1px solid #ffffff24;border-radius:14px;padding:14px;margin:12px 0}
.q{padding:10px;border:1px solid #ffffff22;border-radius:10px;margin:10px 0;background:#ffffff08}
.btn{background:var(--accent);border:none;color:#fff;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
.badges{display:flex;gap:12px;margin-top:6px}
.badge{width:64px;height:64px;border-radius:50%;display:grid;place-items:center;border:2px solid #ffffff33;position:relative;overflow:hidden}
.badge.on{border-color:#10b981;background:radial-gradient( circle at 30% 30%, #22c55e66, transparent 60% )}
.badge.on::after{content:'';position:absolute;width:140%;height:140%;background:conic-gradient(from 0deg,#22c55e33,#22c55e00 40%,#22c55e33);animation:spin 4s linear infinite;mix-blend-mode:screen}
@keyframes spin{to{transform:rotate(360deg)}}
.pbar{height:12px;background:#ffffff15;border:1px solid #ffffff33;border-radius:999px;overflow:hidden}
.pbar>div{height:100%;background:linear-gradient(90deg,#6a00ff,#8b5cf6);width:0%;transition:width .6s}
.row{display:grid;grid-template-columns:1fr 60px;gap:10px;align-items:center}
.small{color:#bdb6df;font-size:12px} .pill{display:inline-block;border:1px solid #ffffff2a;background:#ffffff10;padding:4px 10px;border-radius:999px;margin:2px}
.score{display:inline-block;min-width:36px;text-align:center;border:1px solid #ffffff2a;background:#ffffff14;border-radius:8px;margin-left:8px;padding:2px 6px}
canvas{max-width:100%;background:#0d0a1d;border:1px solid #ffffff18;border-radius:12px}
</style></head><body>
<header><h1>Enervi7 v7.2</h1><div class="sub">14 é¡Œï¼‹é›·é”ï¼‹ç“¶é ¸è£œå¼·ï¼‹å‘¢å–ƒç¥è«­ï¼‹ä»Šæ—¥ç²¾æ²¹ï¼‹7/21/310 ç¨ç«‹æ—…ç¨‹ï¼‹å¾½ç« ï¼‹éš±è—å¡</div></header>
<div class="wrap">

<section class="card"><h2>ğŸŒ€ æ—…ç¨‹é€²åº¦</h2>
  <div class="row"><div>7 æ—¥èƒ½é‡æŒ‘æˆ°</div><div class="small"><b id="s7">0</b> å¤©</div></div>
  <div class="pbar"><div id="pb7"></div></div>
  <div class="row" style="margin-top:8px"><div>21 æ—¥éˆé­‚è½‰åŒ–</div><div class="small"><b id="s21">0</b> å¤©</div></div>
  <div class="pbar"><div id="pb21"></div></div>
  <div class="row" style="margin-top:8px"><div>310 æ—¥é¡¯åŒ–æ—¥è¨˜</div><div class="small"><b id="s310">0</b> å¤©</div></div>
  <div class="pbar"><div id="pb310"></div></div>
  <div class="badges"><div id="b7" class="badge">7</div><div id="b21" class="badge">21</div><div id="b30" class="badge">30</div></div>
  <button class="btn" id="done">âœ… å®Œæˆä»Šæ—¥æ‰“å¡</button> <span id="unlock" class="small"></span>
</section>

<section class="card"><h2>ğŸ§­ 14 é¡Œé‡è¡¨ï¼ˆ0â€“10ï¼‰</h2><div id="qs"></div>
  <button class="btn" id="go">ç”Ÿæˆèƒ½é‡åœ–</button>
  <div id="res" style="display:none;margin-top:10px">
    <div id="sum" class="small">â€”</div>
    <canvas id="radar" width="740" height="500"></canvas>
  </div>
</section>

<section class="card" id="lowestPanel" style="display:none"><h2>ğŸ§© ç“¶é ¸è£œå¼·å¡ï¼ˆè‡ªå‹•å±•é–‹æœ€ä½å…©éšï¼‰</h2><div id="stageTips"></div></section>

<section class="card"><h2>ğŸ´ å‘¢å–ƒç¥è«­</h2><div id="oracle" class="small">â€”</div><button class="btn" id="draw">æŠ½ä¸€å¼µ</button></section>

<section class="card"><h2>ğŸª” ä»Šæ—¥å»ºè­°ç²¾æ²¹</h2><div id="oil" class="small">â€”</div><button class="btn" id="reroll">æ›ä¸€æ¬¾</button></section>

<section class="card"><h2>ğŸŒˆ ä¸ƒéšé—œéµå­—ï¼‹è¡Œå‹•</h2><div id="stageList"></div></section>

<section class="card"><h2>ğŸ—ï¸ å·²è§£é–çš„éš±è—å¡ï¼ˆæ¯ 7 æ—¥è§£é–ä¸€å¼µï¼Œå…± 33 å¼µï¼‰</h2><div id="unlocked" class="small">å°šæœªè§£é–ã€‚</div></section>

</div>
<script>
if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js');}
const P=[{k:'ç™½',n:'è¦ºå¯Ÿ'},{k:'è—',n:'é‡‹æ”¾'},{k:'æ©™',n:'ä¿¡ä»»'},{k:'é»ƒ',n:'è¡Œå‹•'},{k:'ç¶ ',n:'æµå‹•'},{k:'é›è—',n:'å…±é³´'},{k:'ç´«',n:'æ•´åˆ'}];
const Q=[
{p:0,t:'æˆ‘èƒ½æ¸…æ¥šè¦ºå¯Ÿè‡ªå·±æ­¤åˆ»çš„èº«å¿ƒç‹€æ…‹ã€‚'},{p:0,t:'æˆ‘èƒ½åœ¨æ··äº‚æ™‚ï¼Œè¿…é€ŸæŠŠæ³¨æ„åŠ›å¸¶å›ç•¶ä¸‹ã€‚'},
{p:1,t:'é¢å°å£“åŠ›æˆ–è¡çªæ™‚ï¼Œæˆ‘èƒ½ä¿æŒå†·éœä¸å¤±è¡¡ã€‚'},{p:1,t:'æˆ‘èƒ½æœ‰æ•ˆåœ°é‡‹æ”¾ç´¯ç©çš„è² é¢æƒ…ç·’èˆ‡é›œå¿µã€‚'},
{p:2,t:'æˆ‘å¸¸æ„Ÿè¦ºéˆæ„Ÿï¼æƒ…æ„Ÿåœ¨é«”å…§è‡ªç„¶æµå‹•ã€‚'},{p:2,t:'æˆ‘èƒ½é †å‹¢èª¿æ•´æ­¥èª¿ï¼Œä¸åƒµç¡¬æˆ–å¡ä½ã€‚'},
{p:3,t:'åšæ±ºå®šæ™‚ï¼Œæˆ‘èƒ½å …å®šåœ°é¸æ“‡å°è‡ªå·±çœŸçš„å¥½çš„äº‹ã€‚'},{p:3,t:'é‡åˆ°æŒ‘æˆ°ï¼Œæˆ‘ä»èƒ½ç›¸ä¿¡è‡ªå·±ä¸¦å¾€å‰ä¸€æ­¥ã€‚'},
{p:4,t:'æˆ‘èƒ½çœŸèª è¡¨é”ï¼Œä¹Ÿæ¨‚æ–¼å‚¾è½ä»–äººã€‚'},{p:4,t:'æˆ‘èƒ½æ„Ÿåˆ°è‡ªå·±èˆ‡ä»–äººã€èˆ‡ä¸–ç•Œæ˜¯é€£çµçš„ã€‚'},
{p:5,t:'æˆ‘ä¿¡ä»»ç›´è¦ºï¼Œä¸”èƒ½å¾ä¸­ç²å¾—æœ‰ç”¨çš„æŒ‡å¼•ã€‚'},{p:5,t:'æˆ‘èƒ½å¾æ—¥å¸¸äº‹ä»¶çœ‹è¦‹æ›´æ·±çš„æ´è¦‹èˆ‡æ„ç¾©ã€‚'},
{p:6,t:'æˆ‘èƒ½æŠŠéå»çš„ç¶“é©—æ•´åˆæˆåŠ›é‡ï¼Œè€Œä¸æ˜¯æ·é–ã€‚'},{p:6,t:'æˆ‘å¸¸æ„Ÿåˆ°è‡ªå·±å®Œæ•´ã€å°ç”Ÿå‘½æ–¹å‘è¸å¯¦å®‰å¿ƒã€‚'}
];
const host=document.getElementById('qs');
Q.forEach((q,i)=>{
  const e=document.createElement('div');e.className='q';
  e.innerHTML=`<div>${i+1}. <b>${P[q.p].k}ï½œ${P[q.p].n}</b>ï¼${q.t}</div>
    <input type="range" min="0" max="10" step="1" value="5" id="r${i}"><span class="score" id="v${i}">5</span>`;
  host.appendChild(e);
  e.querySelector(`#r${i}`).addEventListener('input',ev=>e.querySelector(`#v${i}`).textContent=ev.target.value);
});

function avg(){
  const s=Array(7).fill(0), c=Array(7).fill(0);
  Q.forEach((q,i)=>{const v=+document.getElementById('r'+i).value; s[q.p]+=v; c[q.p]++;});
  return s.map((x,i)=>c[i]?x/c[i]:0);
}
function radar(vals){
  const cv=document.getElementById('radar'), ctx=cv.getContext('2d');
  const W=cv.width,H=cv.height,cx=W/2,cy=H/2,R=Math.min(W,H)*0.35;
  ctx.clearRect(0,0,W,H); ctx.save(); ctx.translate(cx,cy); ctx.strokeStyle='#ffffff22';
  for(let s=1;s<=5;s++){ctx.beginPath();ctx.arc(0,0,R*s/5,0,Math.PI*2);ctx.stroke();}
  for(let i=0;i<7;i++){const a=-Math.PI/2+i*(Math.PI*2/7);ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(Math.cos(a)*R,Math.sin(a)*R);ctx.stroke();}
  ctx.beginPath();
  for(let i=0;i<7;i++){const a=-Math.PI/2+i*(Math.PI*2/7), rr=(vals[i]/10)*R, x=Math.cos(a)*rr,y=Math.sin(a)*rr; if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);}
  ctx.closePath(); ctx.fillStyle='#6a00ff44'; ctx.fill(); ctx.strokeStyle='#6a00ffbb'; ctx.stroke();
  ctx.fillStyle='#bdb6df'; ctx.font='14px system-ui';
  for(let i=0;i<7;i++){const a=-Math.PI/2+i*(Math.PI*2/7),x=Math.cos(a)*(R+18),y=Math.sin(a)*(R+18); ctx.fillText(P[i].k,x-8,y+5);}
  ctx.restore();
}
function today(){return new Date().toISOString().slice(0,10)}
function pick(a){return a[Math.floor(Math.random()*a.length)]}
async function load(p){const r=await fetch(p);return r.ok?r.json():null}

const K_UN="e7_unlocks_v72";
function read(k,d){try{return JSON.parse(localStorage.getItem(k))??d}catch(_){return d}}
function write(k,v){localStorage.setItem(k,JSON.stringify(v))}

function setBar(id,val,max){const pct=Math.min(100,Math.round(val/max*100)); document.getElementById(id).style.width=pct+'%';}

function refreshJourney(){
  const s7=read('j7',0), s21=read('j21',0), s310=read('j310',0);
  document.getElementById('s7').textContent=s7; setBar('pb7',s7,7);
  document.getElementById('s21').textContent=s21; setBar('pb21',s21,21);
  document.getElementById('s310').textContent=s310; setBar('pb310',s310,310);
  ['b7','b21','b30'].forEach(id=>document.getElementById(id).classList.remove('on'));
  if(s7>=7)document.getElementById('b7').classList.add('on');
  if(s21>=21)document.getElementById('b21').classList.add('on');
  if(s310>=30)document.getElementById('b30').classList.add('on'); // 30 å¤©å¾½ç« ä»¥ 310 è¨˜éŒ„ç‚ºåŸºæº–
}
refreshJourney();

document.getElementById('done').onclick=async()=>{
  const last=read('last',''), t=today();
  if(last!==t){
    // ä¸‰æ¢é€²åº¦éƒ½ +1
    write('j7',(read('j7',0)+1)%8); // 7 æ—¥å¾ªç’°åˆ°é” 7 æœƒç¹¼çºŒå‰é€²ï¼ˆä¿ç•™é”æ¨™ï¼‰ï¼Œä½†é¡¯ç¤º mod 8 é˜² overflow
    write('j21',minKeep(read('j21',0)+1,21));
    write('j310',minKeep(read('j310',0)+1,310));
    write('last',t); refreshJourney();
    // è§£é–éš±è—å¡ï¼ˆæ¯ 7 å¤©ä¸€æ¬¡ï¼Œä»¥ 7 æ—¥æŒ‘æˆ°æ›ç®—ï¼‰
    const deck=await load('hidden_cards.json'); const ids=read(K_UN,[]);
    const s7=read('j7',0); if(s7%7==0){ const next=deck.find(c=>!ids.includes(c.id)); if(next){ids.push(next.id); write(K_UN,ids); renderUnlocked(ids,deck); document.getElementById('unlock').textContent='è§£é–ï¼š'+next.title;}}
    else document.getElementById('unlock').textContent='å·²æ‰“å¡ âœ”ï¸';
  } else { document.getElementById('unlock').textContent='ä»Šå¤©å·²æ‰“å¡'; }
}
function minKeep(v,max){return v>max?max:v}

async function renderUnlocked(ids=null,deck=null){
  deck=deck||await load('hidden_cards.json'); ids=ids or read(K_UN,[]);
  const box=document.getElementById('unlocked');
  if(!ids.length){box.textContent='å°šæœªè§£é–ã€‚'; return}
  box.innerHTML=ids.map(i=>{const c=deck.find(x=>x.id===i); return `<span class="pill">#${c.id}ï½œ${c.title}</span>`}).join(' ');
}
renderUnlocked();

async function showOracle(){
  const store='e7_oracle_v72'; const deck=await load('oracle_whispering.json'); const rec=read(store,{}); const t=today(); let card;
  if(rec.d!==t){ card=pick(deck); write(store,{d:t,id:card.id}); } else { card=deck.find(x=>x.id===rec.id)||deck[0];}
  document.getElementById('oracle').innerHTML=`<b>ã€Œ${card.title}ã€</b><div class="small">${card.poem}</div><div>è¡Œå‹•ï¼š${card.action}</div>`;
}
async function showOil(force){
  const store='e7_oil_v72'; const list=await load('yl_blends.json'); const rec=read(store,{}); const t=today(); let item;
  if(force||rec.d!==t){ item=pick(list); write(store,{d:t,name:item.name}); } else { item=list.find(x=>x.name===rec.name)||list[0];}
  document.getElementById('oil').innerHTML=`<b>${item.name}ï¼ˆ${item.zh_name}ï¼‰</b><div class="small">${item.description}</div>`;
}
document.getElementById('draw').onclick=showOracle; document.getElementById('reroll').onclick=()=>showOil(true); showOracle(); showOil();

async function renderStageList(){
  const data=await load('stages.json'); const order=['S1','S2','S3','S4','S5','S6','S7']; const box=document.getElementById('stageList'); box.innerHTML='';
  order.forEach((k,i)=>{const st=data[k]; const el=document.createElement('div'); el.className='q';
    el.innerHTML=`<div><b>${i+1}. ${st.name} (${st.en})</b></div>`+ st.keywords.map(x=>`<span class='pill'>${x}</span>`).join(' ') + `<div class='small'>è¡Œå‹•ï¼š${st.actions.join('ã€')}</div>`;
    box.appendChild(el);
  });
}
renderStageList();

async function renderLowest(a){
  const idx=a.map((v,i)=>[v,i]).sort((x,y)=>x[0]-y[0]).slice(0,2).map(x=>x[1]);
  const data=await load('stages.json'); const trans=await load('transitions.json'); const order=['S1','S2','S3','S4','S5','S6','S7'];
  const box=document.getElementById('stageTips'); box.innerHTML='';
  idx.forEach(i=>{const k=order[i],st=data[k],tid='T'+(i+1),t=trans[tid]; const div=document.createElement('div'); div.className='q';
    div.innerHTML=`<div><b>${st.name}</b>ï¼ˆ${P[i].k}ï¼‰</div><div class='small'>é—œéµå­—ï¼š${st.keywords.join('ã€')}</div><div>å»ºè­°ï¼š${st.actions.join('ã€')}</div><div class='small'>${t.title}ï¼š${t.tips.join('ï¼›')}</div>`; box.appendChild(div);});
  document.getElementById('lowestPanel').style.display='block';
}

document.getElementById('go').onclick=()=>{
  const a=avg(); const maxI=a.indexOf(Math.max(...a)), minI=a.indexOf(Math.min(...a));
  document.getElementById('sum').textContent=`æœ€é«˜ï¼š${P[maxI].k} ${a[maxI].toFixed(1)}ï¼æœ€ä½ï¼š${P[minI].k} ${a[minI].toFixed(1)}`;
  document.getElementById('res').style.display='block'; radar(a); renderLowest(a);
};
</script></body></html>
