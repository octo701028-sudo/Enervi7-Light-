
<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<link rel="manifest" href="manifest.json"/>
<title>Enervi7 PWA</title>
<style>
:root{
  --bg:#0f0b1d; --card:#17122b; --ink:#e9e7ff; --muted:#bfb8ff;
  --brand:#7b3fe4; --accent:#9c6bff; --ok:#26d07c; --warn:#ffcc66;
}
html,body{background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Helvetica Neue",PingFangTC,"Noto Sans TC",sans-serif;margin:0}
h1{font-size:28px;margin:22px 16px 8px}
h2{font-size:22px;margin:18px 0 10px}
.container{padding:12px 16px 80px}
.card{background:var(--card);border-radius:14px;padding:16px;margin:14px 0;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.badge{display:inline-block;padding:4px 10px;border-radius:999px;background:linear-gradient(135deg,var(--brand),var(--accent));font-weight:700}
.button{background:var(--brand);color:#fff;border:none;border-radius:12px;padding:10px 14px;font-weight:700}
.button.ghost{background:transparent;border:1px solid var(--muted);color:var(--muted)}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.progress{height:10px;border-radius:999px;background:#2a2344;overflow:hidden}
.progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#5fe3ff)}
.circle{width:68px;height:68px;border-radius:50%;display:grid;place-items:center;background:#1e1840;box-shadow:inset 0 0 0 3px #2a2344;color:var(--muted);font-weight:800}
.circle.glow{animation:glow 1.4s ease-out 3}
@keyframes glow{from{box-shadow:0 0 0 0 rgba(155,108,255,.9)}to{box-shadow:0 0 40px 16px rgba(155,108,255,0)}}
.slider{width:100%}
.label{opacity:.9;margin:.3rem 0 .2rem}
.kpill{display:inline-block;padding:2px 8px;border-radius:999px;background:#241d3f;color:#cabdff;margin-right:6px}
.small{font-size:13px;color:#c5bfff}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace}
.radar{width:100%;height:260px}
.sectionTitle{font-size:20px;margin-bottom:8px}
</style>
</head>
<body>
<h1>Enervi7 <span class="small">ï¼ˆv7.3.1ï¼‰</span></h1>
<div class="container">

  <div class="card" id="journey">
    <div class="sectionTitle">ğŸŒ€ æ—…ç¨‹é€²åº¦</div>
    <div class="small">æ‰“å¡æœƒåŒæ™‚æ¨é€² 7 / 21 / 310 å¤©ä¸‰æ¢æ—…ç¨‹ã€‚</div>
    <div class="label">7 æ—¥èƒ½é‡æŒ‘æˆ° <span class="small mono" id="d7txt"></span></div>
    <div class="progress"><i id="p7" style="width:0%"></i></div>
    <div class="label">21 æ—¥éˆé­‚è½‰åŒ– <span class="small mono" id="d21txt"></span></div>
    <div class="progress"><i id="p21" style="width:0%"></i></div>
    <div class="label">310 æ—¥é¡¯åŒ–æ—¥è¨˜ <span class="small mono" id="d310txt"></span></div>
    <div class="progress"><i id="p310" style="width:0%"></i></div>
    <div class="row" style="margin-top:10px">
      <div class="circle" id="c7">7</div>
      <div class="circle" id="c21">21</div>
      <div class="circle" id="c30">30</div>
      <button class="button" id="checkin">âœ… å®Œæˆä»Šæ—¥æ‰“å¡</button>
    </div>
    <div class="small" id="unlockMsg"></div>
  </div>

  <div class="card">
    <div class="sectionTitle">ğŸ§­ 14 é¡Œé‡è¡¨ï¼ˆ0â€“10ï¼‰</div>
    <div id="scaleWrap"></div>
    <button class="button" id="genRadar">ç”Ÿæˆèƒ½é‡åœ–</button>
    <div id="radarHost" class="radar"></div>
    <div class="small" id="scoreSummary"></div>
  </div>

  <div class="card" id="oracleCard">
    <div class="sectionTitle">ğŸ“œ å‘¢å–ƒç¥è«­</div>
    <div id="oracleText" style="line-height:1.6"></div>
    <div style="margin-top:10px"><button class="button ghost" id="drawOracle">æ›ä¸€å¼µ</button></div>
  </div>

  <div class="card" id="oilCard">
    <div class="sectionTitle">ğŸª” ä»Šæ—¥å»ºè­°ç²¾æ²¹</div>
    <div id="oilText" style="line-height:1.6"></div>
    <div style="margin-top:10px"><button class="button ghost" id="nextOil">æ›ä¸€æ¬¾</button></div>
  </div>

  <div class="card" id="infoCard">
    <div class="sectionTitle">ğŸŒˆ ä¸ƒéšè³‡è¨Šå¡ï¼ˆè‡ªå‹•å±•é–‹æœ€ä½åˆ†ï¼‰</div>
    <div id="cardsWrap"></div>
  </div>
</div>

<script>
// --- state helpers ---
const ls = (k,v)=> v===undefined ? JSON.parse(localStorage.getItem(k)||"null")
                                 : localStorage.setItem(k,JSON.stringify(v));
const todayKey = ()=> new Date().toISOString().slice(0,10);

// --- journey progress ---
function getProgress(){
  return ls("journey") || {last: "", d7:0, d21:0, d310:0};
}
function setProgress(p){ ls("journey",p); renderProgress(); }
function renderProgress(){
  const p = getProgress();
  const pct = (d,base)=> Math.min(100, (d%base)/base*100);
  document.getElementById('p7').style.width = pct(p.d7,7)+"%";
  document.getElementById('p21').style.width = pct(p.d21,21)+"%";
  document.getElementById('p310').style.width = pct(p.d310,310)+"%";
  document.getElementById('d7txt').textContent = `ï¼ˆç¬¬ ${p.d7%7}/7 å¤©ï¼‰`;
  document.getElementById('d21txt').textContent = `ï¼ˆç¬¬ ${p.d21%21}/21 å¤©ï¼‰`;
  document.getElementById('d310txt').textContent = `ï¼ˆç¬¬ ${p.d310%310}/310 å¤©ï¼‰`;
}
function celebrate(id){ const el=document.getElementById(id); el.classList.add('glow'); setTimeout(()=>el.classList.remove('glow'),1600); }
document.getElementById('checkin').onclick = ()=>{
  const t = todayKey(); const p = getProgress();
  if(p.last===t){ alert("ä»Šæ—¥å·²æ‰“å¡"); return; }
  p.last = t; p.d7++; p.d21++; p.d310++;
  let msg = "";
  if(p.d7%7===0){ celebrate('c7'); msg += "ğŸ‰ å®Œæˆ 7 æ—¥èƒ½é‡æŒ‘æˆ°ï¼Œè§£é– 1 å¼µéš±è—éˆé­‚å¡ã€‚\n"; }
  if(p.d21%21===0){ celebrate('c21'); msg += "ğŸ… é€£çºŒ 21 æ—¥ï¼šç²å¾—ã€Œå…‰ä¹‹è¡Œè€…ã€å¾½ç« ï¼\n"; }
  if(p.d30===undefined) p.d30=0;
  p.d30++;
  if(p.d30%30===0){ celebrate('c30'); msg += "ğŸŒŸ é€£çºŒ 30 æ—¥ï¼šè§£é–ã€Œéˆé­‚æ•´åˆå¡ã€ã€‚\n"; }
  setProgress(p); document.getElementById('unlockMsg').textContent = msg;
};

// --- scale: 14 items (7*2) ---
const facets = [
  ["ç™½ï½œèƒ½é‡è¦ºçŸ¥",["æˆ‘èƒ½æ¸…æ¥šè¦ºå¯Ÿè‡ªå·±æ­¤åˆ»çš„èº«å¿ƒç‹€æ…‹ã€‚","æˆ‘èƒ½åœ¨æ··äº‚æ™‚ï¼Œè¿…é€ŸæŠŠæ³¨æ„åŠ›å¸¶å›ç•¶ä¸‹ã€‚"]],
  ["è—ï½œç©©å®šèˆ‡æ·¨åŒ–",["é¢å°å£“åŠ›æˆ–è¡çªæ™‚ï¼Œæˆ‘èƒ½ä¿æŒå†·éœä¸å¤±è¡¡ã€‚","æˆ‘èƒ½æœ‰æ•ˆåœ°é‡‹æ”¾ç´¯ç©çš„è² é¢æƒ…ç·’èˆ‡é›œå¿µã€‚"]],
  ["æ©™ï½œèƒ½é‡æµå‹•",["æˆ‘å¸¸æ„Ÿè¦ºéˆæ„Ÿï¼æƒ…æ„Ÿåœ¨é«”å…§è‡ªç„¶æµå‹•ã€‚","æˆ‘èƒ½é †å‹¢èª¿æ•´æ­¥èª¿ï¼Œä¸åƒµç¡¬æˆ–å¡ä½ã€‚"]],
  ["é»ƒï½œå…§åœ¨åŠ›é‡",["åšæ±ºå®šæ™‚ï¼Œæˆ‘èƒ½å …å®šåœ°é¸æ“‡å°è‡ªå·±çœŸçš„å¥½çš„äº‹ã€‚","é‡åˆ°æŒ‘æˆ°ï¼Œæˆ‘ä»èƒ½ç›¸ä¿¡è‡ªå·±ä¸¦å¾€å‰ä¸€æ­¥ã€‚"]],
  ["ç¶ ï½œå…±æŒ¯èˆ‡é€£çµ",["æˆ‘èƒ½çœŸèª è¡¨é”ï¼Œä¹Ÿæ¨‚æ–¼å‚¾è½ä»–äººã€‚","æˆ‘èƒ½æ„Ÿåˆ°è‡ªå·±èˆ‡ä»–äººã€èˆ‡ä¸–ç•Œæ˜¯é€£çµçš„ã€‚"]],
  ["é›è—ï½œæ„è­˜æ“´å±•",["æˆ‘ä¿¡ä»»ç›´è¦ºï¼Œä¸”èƒ½å¾ä¸­ç²å¾—æœ‰ç”¨çš„æŒ‡å¼•ã€‚","æˆ‘èƒ½å¾æ—¥å¸¸äº‹ä»¶çœ‹è¦‹æ›´æ·±çš„æ´è¦‹èˆ‡æ„ç¾©ã€‚"]],
  ["ç´«ï½œéˆé­‚æ•´åˆ",["æˆ‘èƒ½æŠŠéå»çš„ç¶“é©—æ•´åˆæˆåŠ›é‡ï¼Œè€Œä¸æ˜¯æ·é–ã€‚","æˆ‘å¸¸æ„Ÿåˆ°è‡ªå·±å®Œæ•´ã€å°ç”Ÿå‘½æ–¹å‘è¸å¯¦å®‰å¿ƒã€‚"]],
];
function renderScale(){
  const wrap = document.getElementById('scaleWrap'); wrap.innerHTML="";
  facets.forEach((f,i)=>{
    f[1].forEach((q,j)=>{
      const id = `s_${i}_${j}`;
      wrap.insertAdjacentHTML('beforeend',`
        <div class="label">${i*2+j+1}. ${f[0]}ï½œ${q}</div>
        <input class="slider" type="range" min="0" max="10" step="1" value="5" id="${id}">
      `);
    });
  });
}
renderScale();

// --- radar (simple SVG) ---
function genRadar(){
  const vals = facets.map((f,i)=>{
    const a = parseInt(document.getElementById(`s_${i}_0`).value);
    const b = parseInt(document.getElementById(`s_${i}_1`).value);
    return (a+b)/2;
  });
  const host = document.getElementById('radarHost'); const w=host.clientWidth, h=host.clientHeight;
  const cx=w/2, cy=h/2, R=Math.min(w,h)*0.42;
  const toXY = (i,val)=>{
    const ang = (-Math.PI/2) + i*(2*Math.PI/vals.length);
    const r = (val/10)*R;
    return [cx + r*Math.cos(ang), cy + r*Math.sin(ang)];
  };
  let poly="";
  vals.forEach((v,i)=>{ const [x,y]=toXY(i,v); poly += `${x},${y} `; });
  let grid=""; for(let g=1; g<=4; g++){ const r=R*g/4; grid += `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="#2a2344"/>`; }
  let axes=""; for(let i=0;i<vals.length;i++){ const [x,y]=toXY(i,10); axes += `<line x1="${cx}" y1="${cy}" x2="${x}" y2="${y}" stroke="#2a2344"/>`; }
  const svg = `<svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}">
    ${grid}${axes}
    <polygon points="${poly}" fill="rgba(155,108,255,.35)" stroke="#9c6bff" stroke-width="2"/>
  </svg>`;
  host.innerHTML = svg;
  // summary & info cards
  const avg = vals.reduce((a,b)=>a+b,0)/vals.length;
  const minVal = Math.min(...vals); const minIdx = vals.indexOf(minVal);
  document.getElementById('scoreSummary').textContent = `æœ€é«˜ï¼š${Math.max(...vals).toFixed(1)} ï¼ æœ€ä½ï¼š${minVal.toFixed(1)}ï¼ˆ${facets[minIdx][0]}ï¼‰ ï¼ å¹³å‡ï¼š${avg.toFixed(1)}`;
  renderInfoCards(vals,minIdx);
}
document.getElementById('genRadar').onclick = genRadar;

// --- info cards with actions & bottleneck transitions ---
const stageMeta = [
  ["ç™½ï½œèƒ½é‡è¦ºçŸ¥",["è¦ºçŸ¥ç•¶ä¸‹","è¾¨è­˜æƒ…ç·’","çœ‹è¦‹æ¨¡å¼","èª å¯¦é¢å°"],["å¯«ä¸‰å¥ã€æ­¤åˆ»æˆ‘çœŸå¯¦çš„æ„Ÿå—æ˜¯â€¦ã€","3 åˆ†é˜è…¹å¼å‘¼å¸ï¼ˆ4-4-6ï¼‰ä¸¦è¨˜éŒ„èº«é«”æ„Ÿå—","åˆ—å‡º 1 å€‹åè¦†å¿µé ­ï¼Œæ¨™è¨˜ï¼šäº‹å¯¦é‚„æ˜¯è§£è®€ï¼Ÿ"]],
  ["è—ï½œç©©å®šèˆ‡æ·¨åŒ–",["ç©©å®š","é‡‹æ”¾","ç•Œç·š"],["å¯«ä¸‹æœ€å›°æ“¾ä½ çš„ 1 ä»¶äº‹ï¼Œæ¨™è¨» å¯æ§ï¼ä¸å¯æ§","æƒ…ç·’æ›¸å¯« 2 æ®µå¾Œï¼Œåš 60 ç§’èº«é«”æ”¾é¬†","ä»Šå¤©å®Œæˆä¸€ä»¶è¢«æ‹–å»¶çš„å°äº‹ä¸¦æ‰“å‹¾"]],
  ["æ©™ï½œèƒ½é‡æµå‹•",["å°ˆæ³¨","æµå‹•","éˆæ„Ÿ"],["ç•ªèŒ„é˜ 25 åˆ†é˜å…¨ç¨‹å°ˆæ³¨","æŠŠå¡é»â†’èª¿æ•´ 1 å€‹å¾®ç­–ç•¥ï¼ˆA/Bï¼‰","è¨˜éŒ„ 1 å€‹æœ‰æ•ˆå›é¥‹ï¼Œæ˜å¤©æ²¿ç”¨"]],
  ["é»ƒï½œå…§åœ¨åŠ›é‡",["æ±ºæ–·","é‚Šç•Œ","æ‰¿æ“”"],["æŠŠç›®æ¨™æ‹†æˆ 10 åˆ†é˜å¯å®Œæˆçš„ä¸€æ­¥","è¨­å®šä»Šæ—¥ 3 ä»¶ MIT","å®Œæˆå¾Œã€å…¬é–‹å›å ±ã€çµ¦å¯ä¿¡ä»»å°è±¡"]],
  ["ç¶ ï½œå…±æŒ¯èˆ‡é€£çµ",["é€£çµ","åƒ¹å€¼æ„Ÿ","è²¢ç»"],["åˆ†äº«ä¸€å€‹å°æˆæœåˆ°ç¤¾ç¾¤ï¼æœ‹å‹","é‚€è«‹ 1 äººçµ¦å…·é«”å›é¥‹ï¼ˆ3 å¥ï¼‰","ä¸»å‹•å»ºç«‹ä¸€å€‹åˆä½œå¯èƒ½ï¼ˆç™¼ä¸€å‰‡é‚€è«‹ï¼‰"]],
  ["é›è—ï½œæ„è­˜æ“´å±•",["ç›´è¦º","æ´è¦‹","è¦–é‡"],["å¯« 3 å¥ã€æˆ‘å…è¨±â€¦ã€","å›é¡§ 1 æ¬¡è¢«æ”¯æŒçš„è­‰æ“šï¼Œå¯«ä¸‹å¯è¤‡è£½åŸå› ","ä»Šå¤©ä¸»å‹•è«‹æ±‚ä¸€æ¬¡å¹«åŠ©ï¼ˆå°ç¯„åœï¼‰"]],
  ["ç´«ï½œéˆé­‚æ•´åˆ",["ç¸½çµ","å›ºåŒ–","é•·æœŸåŒ–"],["ç”¨ 5 å¥è©±æ‘˜è¦æœ¬é€± 3 ä»¶å­¸åˆ°ï¼‹1 æ”¹é€²","æŠŠæœ‰æ•ˆæ­¥é©Ÿå¯«æˆ Checklist ä¸¦å›ºå®šåˆ°è¡Œç¨‹","ç‚ºä¸‹è¼ªè¨­å®šä¸€å€‹å¯è¡¡é‡æŒ‡æ¨™ï¼ˆKPIï¼‰"]],
];
const bridge = {
  "0-1":[ "æŠŠã€æˆ‘è§€å¯Ÿåˆ°â€¦ã€æ”¹å¯«æˆã€æˆ‘é¡˜æ„æ”¾ä¸‹â€¦ã€Ã—3", "æƒ…ç·’æ›¸å¯«â†’èº«é«”æ”¾é¬†æ”¶å°¾ï¼ˆé ¸è‚©ï¼è…¹éƒ¨ï¼‰" ],
  "1-2":[ "åˆ—å‡º 3 å€‹ç¾æœ‰è³‡æºï¼ˆäººï¼ç‰©ï¼æŠ€èƒ½ï¼‰", "å¯« 1 æ®µï¼šè‹¥ä¸€åˆ‡å°æˆ‘æœ‰åˆ©ï¼Œä»Šå¤©æˆ‘å…è¨±ä»€éº¼ï¼Ÿ" ],
  "2-3":[ "ç”¢å‡ºã€æœ€å°å¯è¡Œæ­¥é©Ÿã€ä¸¦åœ¨ 10 åˆ†é˜å…§å•Ÿå‹•", "é ç´„ 1 å€‹ã€è¡Œå‹•æ™‚æ®µã€ï¼Œè¡Œå‰åªåšæº–å‚™æ¸…å–®" ],
  "3-4":[ "æŠŠä»Šæ—¥è¡Œå‹•å›é¥‹è¨˜éŒ„ä¸¦åš 1 æ¬¡å¾®èª¿", "å»ºç«‹ 25 åˆ†é˜å°ˆæ³¨å„€å¼ï¼ŒçµæŸå›é¡§ 2 åˆ†é˜" ],
  "4-5":[ "å…¬é–‹åˆ†äº« 1 å€‹é€²å±•ï¼æ¡ˆä¾‹ï¼Œç´¢å–å…·é«”å›é¥‹", "è¾¨è­˜æœ€è¢«å…±é³´çš„åƒ¹å€¼ï¼Œæ˜å¤©ä¸»æ‰“è©²å…ƒç´ " ],
  "5-6":[ "æŠŠæœ‰æ•ˆåšæ³•å¯«æˆ SOPï¼Checklist", "é¸ä¸€å€‹å¯æŒçºŒç¯€å¥ï¼ˆé€±ï¼æœˆï¼‰æ”¾é€²è¡Œäº‹æ›†" ],
  "6-0":[ "æœ¬é€±å›é¡§ 3 å¥ï¼‹ä¸‹ä¸€è¼ªæ–°æ„åœ– 1 å¥", "æŒ‘é¸ 1 å€‹æ¬²ç²¾é€²çš„æŒ‡æ¨™ï¼Œè¨­ç½®è§€æ¸¬æ–¹å¼" ]
};
function renderInfoCards(vals,minIdx){
  const wrap = document.getElementById('cardsWrap'); wrap.innerHTML="";
  // expand the two lowest
  const order = vals.map((v,i)=>({v,i})).sort((a,b)=>a.v-b.v).slice(0,2).map(o=>o.i);
  order.forEach(idx=>{
    const [name,keywords,acts] = stageMeta[idx];
    const next = (idx+1)%7;
    const bkey = `${idx}-${next}`;
    wrap.insertAdjacentHTML('beforeend',`
      <div class="card" style="background:#1b1440">
        <div class="row" style="justify-content:space-between">
          <div><span class="kpill">æœ€ä½åˆ†</span> <b>${name}</b></div>
          <div class="small">é—œéµå­—ï¼š${keywords.map(k=>`<span class="kpill">${k}</span>`).join(' ')}</div>
        </div>
        <div class="label">è¡Œå‹•å»ºè­°</div>
        <ul>${acts.map(a=>`<li>${a}</li>`).join("")}</ul>
        <div class="label">ç“¶é ¸è½‰æ›ï¼ˆ${name.split("ï½œ")[0]}â†’${stageMeta[next][0].split("ï½œ")[0]}ï¼‰</div>
        <ul>${bridge[bkey].map(a=>`<li>${a}</li>`).join("")}</ul>
      </div>
    `);
  });
}

// --- oracle ---
let oracleData=[], oilData=[];
async function loadData(){
  oracleData = await fetch('oracle_whispering.json').then(r=>r.json());
  oilData = await fetch('yl_blends.json').then(r=>r.json());
  drawOracle(true); nextOil(true);
}
function drawOracle(first=false){
  const key = "oracleDrawn-"+todayKey();
  let card = first ? ls(key) : null;
  if(!card){
    card = oracleData[Math.floor(Math.random()*oracleData.length)];
    ls(key,card);
  }
  document.getElementById('oracleText').innerHTML = `<b>ã€Œ${card.title}ã€</b><br>${card.poem}<br><span class="small">${card.action}</span>`;
}
document.getElementById('drawOracle').onclick = ()=>{ ls("oracleDrawn-"+todayKey(), null); drawOracle(false); };

let oilIdx=0;
function nextOil(first=false){
  if(!first) oilIdx = (oilIdx+1)%oilData.length;
  const b = oilData[oilIdx];
  document.getElementById('oilText').innerHTML = `<b>${b.name}</b>ï¼ˆ${b.zh_name}ï¼‰<br>${b.description}`;
}
document.getElementById('nextOil').onclick = ()=> nextOil(false);

loadData();

// register SW
if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js'); }
</script>
</body>
</html>
