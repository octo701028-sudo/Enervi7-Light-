
<!DOCTYPE html><html lang="zh-Hant"><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Enervi7 v7.0</title>
<link rel="manifest" href="manifest.json"><meta name="theme-color" content="#6a00ff">
<style>
:root{--bg:#0f0b1e;--panel:#141126;--accent:#6a00ff;--text:#ece8ff;--muted:#bdb6df}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto}
header{padding:18px 16px;background:linear-gradient(90deg,#6a00ff,#8b5cf6)}
h1{margin:0;font-size:22px}.hint{color:var(--muted);font-size:13px}
.wrap{max-width:960px;margin:16px auto;padding:0 14px}
.card{background:var(--panel);border:1px solid #ffffff20;border-radius:14px;padding:14px;margin:12px 0}
.q{padding:8px 10px;border:1px solid #ffffff22;border-radius:10px;margin:8px 0;background:#ffffff08}
.btn{background:var(--accent);border:none;color:#fff;border-radius:10px;padding:10px 14px;font-weight:600}
.badges{display:flex;gap:10px}.badge{width:60px;height:60px;border-radius:50%;display:grid;place-items:center;border:2px solid #ffffff33}
.badge.on{background:#10b98122;border-color:#10b981}
.score{padding:3px 8px;border:1px solid #ffffff2a;border-radius:8px;background:#ffffff14}
.pill{display:inline-block;background:#ffffff12;border:1px solid #ffffff24;border-radius:999px;padding:4px 10px;margin:2px;font-size:12px}
.small{font-size:12px;color:#bdb6df}
canvas{max-width:100%;background:#0d0a1d;border:1px solid #ffffff18;border-radius:12px}
</style></head><body>
<header><h1>Enervi7 v7.0</h1><div class="hint">14 é¡Œï¼‹é›·é”ï¼‹æœ€ä½åˆ†è£œå¼·ï¼‹å‘¢å–ƒç¥è«­ï¼‹ä»Šæ—¥ç²¾æ²¹ï¼‹æ—…ç¨‹å¾½ç« ï¼‹éš±è—å¡</div></header>
<div class="wrap">
<section class="card"><h2>ğŸŒ€ æ—…ç¨‹ & å¾½ç« </h2>
  <div>é€£çºŒï¼š<b id="streak">0</b> ï½œ ç´¯ç©ï¼š<b id="total">0</b></div>
  <div class="badges" style="margin-top:8px">
    <div id="b7" class="badge">7</div><div id="b21" class="badge">21</div><div id="b30" class="badge">30</div>
  </div>
  <button class="btn" id="done">âœ… å®Œæˆä»Šæ—¥</button> <span id="unlock" class="small"></span>
</section>

<section class="card"><h2>ğŸ§­ 14 é¡Œé‡è¡¨ï¼ˆ0â€“10ï¼‰</h2><div id="qs"></div>
  <button class="btn" id="go">ç”Ÿæˆèƒ½é‡åœ–</button>
  <div id="res" style="display:none;margin-top:10px">
    <div id="sum" class="hint">â€”</div>
    <canvas id="radar" width="740" height="500"></canvas>
  </div>
</section>

<section class="card" id="lowestPanel" style="display:none"><h2>ğŸ§© ç“¶é ¸è£œå¼·å¡</h2><div id="stageTips"></div></section>

<section class="card"><h2>ğŸ´ å‘¢å–ƒç¥è«­</h2><div id="oracle" class="hint">â€”</div><button class="btn" id="draw">æŠ½ä¸€å¼µ</button></section>

<section class="card"><h2>ğŸª” ä»Šæ—¥å»ºè­°ç²¾æ²¹</h2><div id="oil" class="hint">â€”</div><button class="btn" id="reroll">æ›ä¸€æ¬¾</button></section>

<section class="card"><h2>ğŸŒˆ ä¸ƒéšé—œéµå­—ï¼‹è¡Œå‹•</h2><div id="stageList"></div></section>

<section class="card"><h2>ğŸ—ï¸ å·²è§£é–çš„éš±è—å¡</h2><div id="unlocked" class="small">å°šæœªè§£é–ã€‚</div></section>
</div>

<script>
if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js');}
const P=[{k:'ç™½',n:'è¦ºå¯Ÿ'},{k:'è—',n:'é‡‹æ”¾'},{k:'æ©™',n:'ä¿¡ä»»'},{k:'é»ƒ',n:'è¡Œå‹•'},{k:'ç¶ ',n:'æµå‹•'},{k:'é›è—',n:'å…±é³´'},{k:'ç´«',n:'æ•´åˆ'}];
const Q=[
{p:0,t:'æˆ‘èƒ½æ¸…æ¥šè¦ºå¯Ÿè‡ªå·±æ­¤åˆ»çš„èº«å¿ƒç‹€æ…‹ã€‚'},{p:0,t:'æˆ‘èƒ½åœ¨æ··äº‚æ™‚ï¼Œè¿…é€ŸæŠŠæ³¨æ„åŠ›å¸¶å›ç•¶ä¸‹ã€‚'},
{p:1,t:'é¢å°å£“åŠ›æˆ–è¡çªæ™‚ï¼Œæˆ‘èƒ½ä¿æŒå†·éœä¸å¤±è¡¡ã€‚'},{p:1,t:'æˆ‘èƒ½æœ‰æ•ˆåœ°é‡‹æ”¾ç´¯ç©çš„è² é¢æƒ…ç·’èˆ‡é›œå¿µã€‚'},
{p:2,t:'æˆ‘å¸¸æ„Ÿè¦ºéˆæ„Ÿï¼æƒ…æ„Ÿåœ¨é«”å…§è‡ªç„¶æµå‹•ã€‚'},{p:2,t:'æˆ‘èƒ½é †å‹¢èª¿æ•´æ­¥èª¿ï¼Œä¸åƒµç¡¬æˆ–å¡ä½ã€‚'},
{p:3,t:'åšæ±ºå®šæ™‚ï¼Œæˆ‘èƒ½å …å®šåœ°é¸æ“‡å°è‡ªå·±çœŸçš„å¥½çš„äº‹ã€‚'},{p:3,t:'é‡åˆ°æŒ‘æˆ°ï¼Œæˆ‘ä»èƒ½ç›¸ä¿¡è‡ªå·±ä¸¦å¾€å‰ä¸€æ­¥ã€‚'},
{p:4,t:'æˆ‘èƒ½çœŸèª è¡¨é”ï¼Œä¹Ÿæ¨‚æ–¼å‚¾è½ä»–äººã€‚'},{p:4,t:'æˆ‘èƒ½æ„Ÿåˆ°è‡ªå·±èˆ‡ä»–äººã€èˆ‡ä¸–ç•Œæ˜¯é€£çµçš„ã€‚'},
{p:5,t:'æˆ‘ä¿¡ä»»ç›´è¦ºï¼Œä¸”èƒ½å¾ä¸­ç²å¾—æœ‰ç”¨çš„æŒ‡å¼•ã€‚'},{p:5,t:'æˆ‘èƒ½å¾æ—¥å¸¸äº‹ä»¶çœ‹è¦‹æ›´æ·±çš„æ´è¦‹èˆ‡æ„ç¾©ã€‚'},
{p:6,t:'æˆ‘èƒ½æŠŠéå»çš„ç¶“é©—æ•´åˆæˆåŠ›é‡ï¼Œè€Œä¸æ˜¯æ·é–ã€‚'},{p:6,t:'æˆ‘å¸¸æ„Ÿåˆ°è‡ªå·±å®Œæ•´ã€å°ç”Ÿå‘½æ–¹å‘è¸å¯¦å®‰å¿ƒã€‚'}
];
const host=document.getElementById('qs');
Q.forEach((q,i)=>{const e=document.createElement('div');e.className='q';e.innerHTML=`<div>${i+1}. <b>${P[q.p].k}ï½œ${P[q.p].n}</b>ï¼${q.t}</div><input type="range" min="0" max="10" step="1" value="5" id="r${i}"><div class="score" id="v${i}">5</div>`;host.appendChild(e);e.querySelector(`#r${i}`).addEventListener('input',ev=>e.querySelector(`#v${i}`).textContent=ev.target.value);});

function avg(){const s=Array(7).fill(0),c=Array(7).fill(0);Q.forEach((q,i)=>{const v=+document.getElementById('r'+i).value;s[q.p]+=v;c[q.p]++});return s.map((x,i)=>c[i]?x/c[i]:0)}
function radar(vals){const cv=document.getElementById('radar'),ctx=cv.getContext('2d'),W=cv.width,H=cv.height,cx=W/2,cy=H/2,R=Math.min(W,H)*0.35;ctx.clearRect(0,0,W,H);ctx.save();ctx.translate(cx,cy);ctx.strokeStyle='#ffffff22';for(let s=1;s<=5;s++){ctx.beginPath();ctx.arc(0,0,R*s/5,0,Math.PI*2);ctx.stroke()}for(let i=0;i<7;i++){const a=-Math.PI/2+i*(Math.PI*2/7);ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(Math.cos(a)*R,Math.sin(a)*R);ctx.stroke()}ctx.beginPath();vals.forEach((v,i)=>{const a=-Math.PI/2+i*(Math.PI*2/7),rr=(v/10)*R;const x=Math.cos(a)*rr,y=Math.sin(a)*rr;i?ctx.lineTo(x,y):ctx.moveTo(x,y)});ctx.closePath();ctx.fillStyle='#7c3aed55';ctx.fill();ctx.strokeStyle='#7c3aed';ctx.stroke();ctx.restore();}

function today(){return new Date().toISOString().slice(0,10)}
function pick(a){return a[Math.floor(Math.random()*a.length)]}
async function load(p){const r=await fetch(p);return r.ok? r.json():null}

const K_STREAK='e7_streak', K_TOTAL='e7_total', K_LAST='e7_lastDay', K_UNLOCK='e7_unlocked';
function read(k,d){try{const v=JSON.parse(localStorage.getItem(k));return v??d}catch(_){return d}}
function write(k,v){localStorage.setItem(k,JSON.stringify(v))}
function updateBadges(){const s=read(K_STREAK,0);document.getElementById('streak').textContent=s;document.getElementById('total').textContent=read(K_TOTAL,0);
['b7','b21','b30'].forEach(id=>document.getElementById(id).classList.remove('on')); if(s>=7)document.getElementById('b7').classList.add('on'); if(s>=21)document.getElementById('b21').classList.add('on'); if(s>=30)document.getElementById('b30').classList.add('on');}
async function onDone(){const last=read(K_LAST,''),t=today();let s=read(K_STREAK,0), tot=read(K_TOTAL,0);
 if(last!==t){ s = (last && ((new Date(t)-new Date(last))===86400000)) ? s+1 : 1; tot+=1; write(K_LAST,t); write(K_STREAK,s); write(K_TOTAL,tot); updateBadges();
 let msg='å·²è¨˜éŒ„ä»Šå¤© âœ”ï¸'; if(s%7===0){ const deck=await load('hidden_cards.json'); const arr=read(K_UNLOCK,[]); const next=deck.find(c=>!arr.includes(c.id)); if(next){arr.push(next.id); write(K_UNLOCK,arr); msg+=' ï½œ è§£é–ï¼š'+next.title; renderUnlocked(arr,deck);} }
 document.getElementById('unlock').textContent=msg; }
}
document.getElementById('done').onclick=onDone; updateBadges();

async function renderUnlocked(ids=null, deck=null){ deck=deck || await load('hidden_cards.json'); ids = ids ?? read(K_UNLOCK,[]); const box=document.getElementById('unlocked'); if(!ids.length){box.textContent='å°šæœªè§£é–ã€‚'; return} box.innerHTML=ids.map(i=>{const c=deck.find(x=>x.id===i); return `<span class='pill'>#${c.id}ï½œ${c.title}</span>`}).join(' ') }

async function showOracle(){ const store='e7_oracle_v70'; const deck=await load('oracle_whispering.json'); const rec=read(store,{}); const t=today(); let card; if(rec.d!==t){ card=pick(deck); write(store,{d:t,id:card.id}); } else { card=deck.find(x=>x.id===rec.id)||deck[0]; } document.getElementById('oracle').innerHTML=`<b>ã€Œ${card.title}ã€</b><div class="hint">${card.poem}</div><div>è¡Œå‹•ï¼š${card.action}</div>` }
async function showOil(force){ const store='e7_oil_v70'; const list=await load('yl_blends.json'); const rec=read(store,{}); const t=today(); let item; if(force||rec.d!==t){ item=pick(list); write(store,{d:t,name:item.name}); } else { item=list.find(x=>x.name===rec.name)||list[0]; } document.getElementById('oil').innerHTML=`<b>${item.name}ï¼ˆ${item.zh_name}ï¼‰</b><div class="hint">${item.description}</div>` }
document.getElementById('draw').onclick=showOracle; document.getElementById('reroll').onclick=()=>showOil(true); showOracle(); showOil(); renderUnlocked();

async function renderStageList(){ const data=await load('stages.json'); const order=['S1','S2','S3','S4','S5','S6','S7']; const box=document.getElementById('stageList'); box.innerHTML=''; order.forEach((k,i)=>{const st=data[k]; const el=document.createElement('div'); el.className='q'; el.innerHTML=`<div><b>${i+1}. ${st.name} (${st.en})</b></div>`+ st.keywords.map(x=>`<span class='pill'>${x}</span>`).join(' ') + `<div class='small'>è¡Œå‹•ï¼š${st.actions.join('ã€')}</div>`; box.appendChild(el); }); }
renderStageList();

async function renderLowest(a){ const idx=a.map((v,i)=>[v,i]).sort((x,y)=>x[0]-y[0]).slice(0,2).map(x=>x[1]); const data=await load('stages.json'); const trans=await load('transitions.json'); const order=['S1','S2','S3','S4','S5','S6','S7']; const box=document.getElementById('stageTips'); box.innerHTML='';
 idx.forEach(i=>{ const k=order[i]; const st=data[k]; const tid='T'+(i+1); const t=trans[tid]; const div=document.createElement('div'); div.className='q'; div.innerHTML=`<div><b>${st.name}</b>ï¼ˆ${P[i].k}ï¼‰</div><div class='small'>é—œéµå­—ï¼š${st.keywords.join('ã€')}</div><div>å»ºè­°ï¼š${st.actions.join('ã€')}</div><div class='small'>${t.title}ï¼š${t.tips.join('ï¼›')}</div>`; box.appendChild(div); }); document.getElementById('lowestPanel').style.display='block'; }

document.getElementById('go').onclick=()=>{ const a=avg(); const maxI=a.indexOf(Math.max(...a)), minI=a.indexOf(Math.min(...a)); document.getElementById('sum').textContent=`æœ€é«˜ï¼š${P[maxI].k} ${a[maxI].toFixed(1)}ï¼æœ€ä½ï¼š${P[minI].k} ${a[minI].toFixed(1)}`; document.getElementById('res').style.display='block'; radar(a); renderLowest(a); };
</script></body></html>
